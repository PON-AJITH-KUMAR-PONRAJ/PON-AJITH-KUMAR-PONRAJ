CREATE DATABASE dbuniversity5036;

\c dbuniversity5036;

CREATE TABLE classroom (
    building VARCHAR(15),
    room_number VARCHAR(7),
    capacity NUMERIC(4,0),
    PRIMARY KEY (building, room_number)
);

CREATE TABLE department (
    dept_name VARCHAR(20),
    building VARCHAR(15),
    budget NUMERIC(12,2) CHECK (budget > 0),
    PRIMARY KEY (dept_name)
);

CREATE TABLE course (
    course_id VARCHAR(7),
    title VARCHAR(50),
    dept_name VARCHAR(20),
    credits NUMERIC(2,0) CHECK (credits > 0),
    PRIMARY KEY (course_id),
    FOREIGN KEY (dept_name) REFERENCES department
    ON DELETE SET NULL
);

CREATE TABLE instructor (
    ID VARCHAR(5),
    name VARCHAR(20) NOT NULL,
    dept_name VARCHAR(20),
    salary NUMERIC(8,2) CHECK (salary > 29000),
    PRIMARY KEY (ID),
    FOREIGN KEY (dept_name) REFERENCES department
    ON DELETE SET NULL
);

CREATE TABLE section (
    course_id VARCHAR(8),
    sec_id VARCHAR(8),
    semester VARCHAR(6) CHECK (semester IN ('Fall', 'Winter', 'Spring', 'Summer')),
    year NUMERIC(4,0) CHECK (year > 1701 AND year < 2100),
    building VARCHAR(15),
    room_number VARCHAR(7),
    time_slot_id VARCHAR(4),
    PRIMARY KEY (course_id, sec_id, semester, year),
    FOREIGN KEY (course_id) REFERENCES course
    ON DELETE CASCADE,
    FOREIGN KEY (building, room_number) REFERENCES classroom
    ON DELETE SET NULL
);

CREATE TABLE teaches (
    ID VARCHAR(5),
    course_id VARCHAR(8),
    sec_id VARCHAR(8),
    semester VARCHAR(6),
    year NUMERIC(4,0),
    PRIMARY KEY (ID, course_id, sec_id, semester, year),
    FOREIGN KEY (course_id, sec_id, semester, year) REFERENCES section
    ON DELETE CASCADE,
    FOREIGN KEY (ID) REFERENCES instructor
    ON DELETE CASCADE
);

CREATE TABLE student (
    ID VARCHAR(5),
    name VARCHAR(20) NOT NULL,
    dept_name VARCHAR(20),
    tot_cred NUMERIC(3,0) CHECK (tot_cred >= 0),
    PRIMARY KEY (ID),
    FOREIGN KEY (dept_name) REFERENCES department
    ON DELETE SET NULL
);

CREATE TABLE takes (
    ID VARCHAR(5),
    course_id VARCHAR(8),
    sec_id VARCHAR(8),
    semester VARCHAR(6),
    year NUMERIC(4,0),
    grade VARCHAR(2),
    PRIMARY KEY (ID, course_id, sec_id, semester, year),
    FOREIGN KEY (course_id, sec_id, semester, year) REFERENCES section
    ON DELETE CASCADE,
    FOREIGN KEY (ID) REFERENCES student
    ON DELETE CASCADE
);

CREATE TABLE advisor (
    s_ID VARCHAR(5),
    i_ID VARCHAR(5),
    PRIMARY KEY (s_ID),
    FOREIGN KEY (i_ID) REFERENCES instructor (ID)
    ON DELETE SET NULL,
    FOREIGN KEY (s_ID) REFERENCES student (ID)
    ON DELETE CASCADE
);

CREATE TABLE prereq (
    course_id VARCHAR(8),
    prereq_id VARCHAR(8),
    PRIMARY KEY (course_id, prereq_id),
    FOREIGN KEY (course_id) REFERENCES course
    ON DELETE CASCADE,
    FOREIGN KEY (prereq_id) REFERENCES course
);

CREATE TABLE timeslot (
    time_slot_id VARCHAR(4),
    day VARCHAR(1),
    start_hr NUMERIC(2) CHECK (start_hr >= 0 AND start_hr < 24),
    start_min NUMERIC(2) CHECK (start_min >= 0 AND start_min < 60),
    end_hr NUMERIC(2) CHECK (end_hr >= 0 AND end_hr < 24),
    end_min NUMERIC(2) CHECK (end_min >= 0 AND end_min < 60),
    PRIMARY KEY (time_slot_id, day, start_hr, start_min)
);

\copy classroom FROM 'E:\DBMS Databases\universitydb\classroom.csv' DELIMITER ',' CSV HEADER;

\copy department FROM 'E:\DBMS Databases\universitydb\department.csv' DELIMITER ',' CSV HEADER;

\copy course FROM 'E:\DBMS Databases\universitydb\course.csv' DELIMITER ',' CSV HEADER;

\copy instructor FROM 'E:\DBMS Databases\universitydb\instructor.csv' DELIMITER ',' CSV HEADER;

\copy section FROM 'E:\DBMS Databases\universitydb\section.csv' DELIMITER ',' CSV HEADER;

\copy teaches FROM 'E:\DBMS Databases\universitydb\teaches.csv' DELIMITER ',' CSV HEADER;

\copy student FROM 'E:\DBMS Databases\universitydb\student.csv' DELIMITER ',' CSV HEADER;

\copy takes FROM 'E:\DBMS Databases\universitydb\takes.csv' DELIMITER ',' CSV HEADER;

\copy advisor FROM 'E:\DBMS Databases\universitydb\advisor.csv' DELIMITER ',' CSV HEADER;

\copy prereq FROM 'E:\DBMS Databases\universitydb\prereq.csv' DELIMITER ',' CSV HEADER;

\copy timeslot FROM 'E:\DBMS Databases\universitydb\timeslot.csv' DELIMITER ',' CSV HEADER;

-- Select all records from the classroom table
SELECT * FROM classroom;

-- Select all records from the department table
SELECT * FROM department;

-- Select all records from the course table
SELECT * FROM course;

-- Select all records from the instructor table
SELECT * FROM instructor;

-- Select all records from the section table
SELECT * FROM section;

-- Select all records from the teaches table
SELECT * FROM teaches;

-- Select all records from the student table
SELECT * FROM student;

-- Select all records from the takes table
SELECT * FROM takes;

-- Select all records from the advisor table
SELECT * FROM advisor;

-- Select all records from the prereq table
SELECT * FROM prereq;

-- Select all records from the timeslot table
SELECT * FROM timeslot;
